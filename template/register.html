<html>
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=0.4,maximum-scale=0.8">
        <title>{%if language_en%}Register | GM Associates{%else%}注册 | 光华茂源{%endif%}</title>
        <link rel="shortcut icon" href="/favicon.ico"/>
        <style>
            body{
                margin: 0;
                overflow: hidden;
                font-family: 微软雅黑;
            }
            a {
                color: black;
                text-decoration: none;
            }
            a:link {
                color: black;
                text-decoration: none;
            }
            a:visited {
                color: black;
                text-decoration: none;
            }
            a:active {
                color: black;
                text-decoration: none;
            }
            a:hover{
                color: black;
                text-decoration:none;
            }
            #banner{
                z-index: -1;
                position: relative;
                width: 100%;
            }
            #banner-img{
                width: 100%;
            }
            #banner-title:after{
                content: '.';
                width: 100%;
                display: inline-block;
                overflow: hidden;
                height: 0;
            }
            .header{
                width: 100%;
                left: 0;
                top: 0;
                z-index: 998;
                background-color: rgba(255, 255, 255, 1);
                height: 88px;
            }
            #header-logo{
                font-size: 32px;
                color:rgb(22,21,88);
                height: 88px;
                line-height: 88px;
                width: 100px;
                text-align: center;
                margin-left: 50px;
                cursor:default;
            }
            #header-inner{
                height: 100%;
                width: 100%;
                max-width: 1300px;
                margin: auto;
                display: flex;
            }
            #header-icons{
                flex-grow: 1;
            }
            .header-icon{
                font-size: 16px;
                font-family: 微软雅黑;
                font-weight: bold;
                position: relative;
                float: right;
                margin-right: 42px;
                line-height: 88px;
                text-align: center;
                color: #2a2a3a;
                cursor: default;
            }
            .banner-title{
                color: white;
                font-size: 80px;
                position: absolute;
                text-align: center;
                top: 50%;
                left: 50%;
                margin-left: -297px;
                font-family: Bower,Georgia,Times New Roman,serif;
            }
            .main-content{
                position: relative;
                width: 100%;
                height: 100%;
                margin: 0 auto;
                margin-bottom: 150px;
                color: #333;
                background-color: rgb(236, 236, 236);
            }
            .login-w{
                position: fixed;
                left: calc(42% - 200px);
                width: calc(16% + 400px);
                background-color: white;
                border-radius: 30px;
                box-shadow: rgb(121, 121, 121) 0 0 30px 0;
                text-align: center;
                line-height: 52px;
            }
            .login-input-w{
                width: 70%;
                max-width: 420px;
                margin: 0 auto;
            }
            .login-input{
                font-size: 18px;
                border: 1px solid rgb(47, 122, 219);
                border-radius: 8px;
                padding: 8px;
                width: 100%;
                margin-top: 16px;
            }
            .half{
                width: 25%;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div id="header-inner">
                <div id="header-logo">
                    <img src="/s/logo-3.png" style="margin: -36% 0 0 -36%; height: 180px;"/>
                </div>
                <div id="header-icons">
                    {% if language_en %}
                    <div class="header-icon"><a style="color:#2a2a3a;" href="/changeLang?to=ch">CHINESE</a></div>
                    {% else %}
                    <div class="header-icon"><a style="color:#2a2a3a;" href="/changeLang?to=en">ENGLISH</a></div>
                    {% endif %}
                    <div class="header-icon"><a style="color:#2a2a3a; padding: 0 0 6px 0; border-bottom: red 2px solid;" href="/doreg0">{%if language_en%}Register{%else%}注册{%endif%}</a></div>
                    <div class="header-icon"><a style="color:#2a2a3a;" href="/info">{%if language_en %}About GMA{%else%}关于我们{%endif%}</a></div>
                    {% for cat in cats %}
                    <div class="header-icon"><a style="color:#2a2a3a;" href="/list-article?fid={{cat.id}}">{% if language_en %}{{cat.name_en}}{%else%}{{cat.name}}{%endif%}</a></div>
                    {% endfor %}
                    <div class="header-icon"><a style="color:#2a2a3a;" href="/home">{%if language_en%}Home{%else%}首页{%endif%}</a></div>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="login-w">
                <div class="login-input-w">
                    <p style="font-size: 24px; font-weight: bold;">{%if language_en%}Register membership{%else%}会员注册{%endif%}</h1>
                    <p>
                        <input class="login-input" type="text" id="email" placeholder="{%if language_en%}Work E-mail{%else%}请输入公司邮箱{%endif%}">
                        <div id="email_wrong" style="color: red;font-size: 16px;line-height: 16px;display: none;">
                            {%if language_en%}Invalid email format, or personal email found.
                            {%else%}邮箱格式不正确或不是企业邮箱
                            {%endif%}
                        </div>
                    </p>
                    <p>
                        <input class="login-input" style="width: 60.4%;" type="text" id="captcha" placeholder="{%if language_en%}CAPTCHA{%else%}邮箱验证码{%endif%}">
                        <input class="login-input" style="width: 38%;" type="button" value="{%if language_en%}Send captcha{%else%}发送验证码{%endif%}" id="email_button">
                    </p>
                    <p>
                        <input class="login-input" type="text" id="username" placeholder="{%if language_en%}Username{%else%}请输入用户名{%endif%}">
                    </p>
                    <p>
                        <input class="login-input" type="password" id="password" placeholder="{%if language_en%}Password{%else%}请输入密码{%endif%}">
                    </p>
                    <p>
                        <input class="login-input" type="submit" id="submit" value="{%if language_en%}Register{%else%}注 册{%endif%}" style="width:30%;border-radius: 15px;border:0;background-color: rgb(73, 82, 214);color: whitesmoke;">
                    </p>
                </div>
            </div>
        </div>
        <style>
            .footer{
                text-align: center;
                font-size: 12px;
                padding: 20px;
            }
        </style>
        <div class="footer">
            <div class="footer-inner">
            <a style="color: #85868c;" href="https://beian.miit.gov.cn/#/Integrated/index">京ICP备10010489号-1</a> <br/> Copyright © 2012 GM &amp; Associates
            </div>
        </div>
        <script type="text/javascript" src="/static/jquery.js"></script>
        <script>
            $('.login-w').css('margin-top', ((window.innerHeight-500)*0.4)+'px');

            $('#email_button').click(function(e){
                let email = $('#email').val();
                function test_email(email){
                    let _e = email.split('@');
                    if(_e.length!==2)return false;
                    let site = _e[1].replace(/^\s\s*/, '').replace(/\s\s*$/, '');
                    if(site.indexOf('.')===-1)return false;
                    let personal = ["163.com", "126.com", "qq.com", ".edu."];
                    for(i=0;i<4;i++){
                        if(site.indexOf(personal[i])!==-1)return false;
                    }
                    return true;
                }
                if(!test_email(email)){
                    $('#email_wrong').show();
                    return;
                }
                else{
                    $('#email_wrong').hide();
                }
                $.ajax('/doreg1?e='+encodeURI(email), {
                    async: false,
                    success: (e)=>{
                        $('#email_button').attr("disabled","disabled");
                        $('#email_button').val('已发送(60)');
                        email_button_i = 59;
                        email_button_interval = setInterval(()=>{
                            $('#email_button').val('已发送('+ email_button_i +')');
                            email_button_i--;
                            if(email_button_i===0){
                                clearInterval(email_button_interval);
                                $('#email_button').attr("disabled",false);
                                $('#email_button').val('发送验证码');
                            }
                        }, 1000);
                    }
                });
            });

            $('#submit').click(()=>{
                url='/doreg2?e='+encodeURI($('#email').val())+'&p='+encodeURI($('#password').val())+'&u='+encodeURI($('#username').val())+'&c='+encodeURI($('#captcha').val());
                $.ajax(url, {
                    success: (msg)=>{
                        if(msg.success){
                            window.location.href = '/login_';
                        }
                        else{
                            alert(msg.msg);
                        }
                    }
                })
            });
            

        </script>
    </body>
</html>